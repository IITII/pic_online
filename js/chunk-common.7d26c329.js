(globalThis["webpackChunkpic_online_front"]=globalThis["webpackChunkpic_online_front"]||[]).push([[64],{33649:(e,t,o)=>{"use strict";o.d(t,{Ti:()=>i,_V:()=>r,gc:()=>s,hA:()=>n,sw:()=>l});o(65663),o(92248),o(68936),o(24067);function i(e=window,t=document){return e.innerHeight?e.innerHeight:t.body&&t.body.clientHeight?t.body.clientHeight:e.screen.availHeight}function n(e=window,t=document){return e.innerWidth?e.innerWidth:t.body&&t.body.clientWidth?t.body.clientWidth:e.screen.availWidth}function r(e,t,o,i,n=!0,r=""){t.dispatch("user/user",e),i.defaults.headers["authorization"]=["Token",e.token].join(" "),n&&o.push({path:r||`/${e.user_type}/image`})}function s(e,t){e.dispatch("user/logout"),t.defaults.headers["authorization"]=""}function l(e,t=""){const o=["admin","maintainer"];return t?`${t} text-white`:o.some((t=>t===e))?"bg-pink-4 text-white":"bg-primary text-white"}},94336:(e,t,o)=>{"use strict";o.d(t,{Z:()=>g});var i=o(83673),n=o(98880);const r={class:"background"},s=["alt","src"];function l(e,t,o,l,a,c){return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",r,[(0,i._)("img",{alt:o.imgAlt,src:c.back,class:"img"},null,8,s)])],512)),[[n.F8,c.back]])}var a=o(33649),c=o(10741);const d={name:"PicBackground",computed:{...(0,c.rn)({background:e=>e.common.background}),back(){return this.backgroundImage||this.background}},beforeMount(){this.$log.debug(this.background),this.resizeImage()},methods:{resizeImage(){let e=document.getElementsByClassName("background");if(e&&e.length>0){e=e[0];const t=`${(0,a.Ti)()}px`;this.$log.debug(`Resize image height to ${t}`),e.style.height=t}}},watch:{back(e){e&&this.resizeImage()}},props:{backgroundImage:{type:String,default:""},imgAlt:{type:String,default:""}}};var u=o(74260);const h=(0,u.Z)(d,[["render",l],["__scopeId","data-v-03ad63c1"]]),g=h},78350:(e,t,o)=>{"use strict";o.d(t,{Z:()=>u});var i=o(83673);function n(e,t,o,n,r,s){const l=(0,i.up)("q-select");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(l,{modelValue:s.lang,"onUpdate:modelValue":t[0]||(t[0]=e=>s.lang=e),dark:!0,options:r.langOptions,"options-dark":e.$q.dark.isActive,"options-dense":!1,borderless:"",color:"pink",dense:"","dropdown-icon":"translate","emit-value":"","map-options":""},null,8,["modelValue","options","options-dark"])])}const r={name:"PicLanguagePicker",data(){return{langOptions:[{value:"en-US",label:"English"},{value:"zh-CN",label:"简体"}]}},computed:{lang:{get:function(){return this.$log.debug("Get language setting"),this.$store.getters["user/language"]||this.$q.lang.getLocale()||"zh-CN"},set:function(e){this.$log.debug(`Set language to ${e}`),this.$i18n.locale=e,this.$store.dispatch("user/language",e)}}},beforeMount(){this.$i18n.locale=this.lang}};var s=o(74260),l=o(68516),a=o(7518),c=o.n(a);const d=(0,s.Z)(r,[["render",n]]),u=d;c()(r,"components",{QSelect:l.Z})},78334:(e,t,o)=>{"use strict";o.d(t,{Z:()=>y});var i=o(83673),n=o(62323);function r(e,t,o,r,s,l){const a=(0,i.up)("q-icon"),c=(0,i.up)("q-item-section"),d=(0,i.up)("q-item-label"),u=(0,i.up)("q-item"),h=(0,i.up)("q-list"),g=(0,i.up)("q-menu"),p=(0,i.up)("q-btn"),m=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(p,{dense:"",flat:"",icon:"more",round:""},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{fit:""},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.links,((e,t)=>(0,i.wy)(((0,i.wg)(),(0,i.j4)(u,{key:t,to:e.link,clickable:""},{default:(0,i.w5)((()=>[e.icon?((0,i.wg)(),(0,i.j4)(c,{key:0,avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(a,{name:e.icon},null,8,["name"])])),_:2},1024)):(0,i.kq)("",!0),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["to"])),[[m]]))),128)),(0,i.wy)(((0,i.wg)(),(0,i.j4)(u,{clickable:"",onClick:l.logout},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(a,{name:"logout"})])),_:1}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.$t("logout")),1)])),_:1})])),_:1},8,["onClick"])),[[m]])])),_:1})])),_:1})])),_:1})])}var s=o(33649);const l={name:"PicMenu",components:{},props:{menuLinks:{type:Array,required:!1,default:e=>[]}},computed:{links(){return this.menuLinks}},methods:{logout(){return(0,s.gc)(this.$store,this.$axios)}}};var a=o(74260),c=o(48240),d=o(20811),u=o(27011),h=o(83414),g=o(52035),p=o(24554),m=o(2350),_=o(60677),b=o(7518),f=o.n(b);const w=(0,a.Z)(l,[["render",r]]),y=w;f()(l,"components",{QBtn:c.Z,QMenu:d.Z,QList:u.Z,QItem:h.Z,QItemSection:g.Z,QIcon:p.Z,QItemLabel:m.Z}),f()(l,"directives",{ClosePopup:_.Z})},57006:(e,t,o)=>{"use strict";o.d(t,{Z:()=>$});var i=o(83673),n=o(62323);const r=["href"];function s(e,t,o,s,l,a){const c=(0,i.up)("q-tab"),d=(0,i.up)("q-tabs"),u=(0,i.up)("q-separator"),h=(0,i.up)("q-input"),g=(0,i.up)("q-tab-panel"),p=(0,i.up)("q-tab-panels"),m=(0,i.up)("q-btn"),_=(0,i.up)("q-card-section"),b=(0,i.up)("q-badge"),f=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(f,{class:"setting_sty"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:l.selectTab,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectTab=e),"active-bg-color":"pink-1","active-color":"pink-4",align:"justify",class:"text-teal","indicator-color":"pink-5"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.namespace.keys(),(e=>((0,i.wg)(),(0,i.j4)(c,{key:e,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),(0,i.Wm)(u),(0,i.Wm)(p,{modelValue:l.selectTab,"onUpdate:modelValue":t[1]||(t[1]=e=>l.selectTab=e),animated:""},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.namespace.keys(),((e,t)=>((0,i.wg)(),(0,i.j4)(g,{key:t,name:e},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.namespace.get(l.selectTab),(e=>((0,i.wg)(),(0,i.j4)(h,{key:e,modelValue:l.store[e],"onUpdate:modelValue":t=>l.store[e]=t,label:e,dense:l.dense},null,8,["modelValue","onUpdate:modelValue","label","dense"])))),128))])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"]),(0,i.Wm)(_,{style:{"text-align":"center",padding:"3px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:a.submit,color:"primary",label:e.$t("submit"),class:"btn-style"},null,8,["onClick","label"]),(0,i.Wm)(m,{onClick:a.reset,color:"accent",label:e.$t("revert"),class:"btn-style"},null,8,["onClick","label"]),(0,i.Wm)(m,{onClick:a.btn_default,color:"negative",label:e.$t("default"),class:"btn-style"},null,8,["onClick","label"])])),_:1}),(0,i.Wm)(u),(0,i.Wm)(_,{style:{height:"25px","text-align":"center",padding:"2px"}},{default:(0,i.w5)((()=>[(0,i._)("a",{href:l.authorInfo.repo.url,style:{"text-decoration":"none"},target:"_blank"},[(0,i.Wm)(b,{color:l.badge.color,"text-color":l.badge.text_color,outline:""},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(l.authorInfo.repo.name),1)])),_:1},8,["color","text-color"])],8,r)])),_:1})])),_:1})}const l={name:"PicStoreSettings",data(){return{selectTab:"",store:{},dense:!1,authorInfo:{repo:{name:"Vue Store Management by IITII",url:"https://github.com/iitii/pic_online",author:"Github@IITII"}},badge:{color:"pink",text_color:"white"}}},mounted(){this.reset()},computed:{namespace(){const e=new Map,t="default";for(let o in this.store){const i=o.includes("/")?o.split("/")[0]:t;e.has(i)?e.set(i,e.get(i).concat(o)):e.set(i,[o])}return e}},methods:{submit(){const e=this.namespace.get(this.selectTab);for(let t in e){const o=e[t];this.$store.dispatch(o,this.store[o])}},reset(){this.store=JSON.parse(JSON.stringify(this.$store.getters)),this.$log.debug(this.namespace.keys().next().value),this.selectTab=this.namespace.keys().next().value},btn_default(){localStorage.clear()}}};var a=o(74260),c=o(10151),d=o(57547),u=o(3269),h=o(65869),g=o(5906),p=o(86602),m=o(34842),_=o(25589),b=o(48240),f=o(69721),w=o(7518),y=o.n(w);const k=(0,a.Z)(l,[["render",s],["__scopeId","data-v-2a4e9380"]]),$=k;y()(l,"components",{QCard:c.Z,QTabs:d.Z,QTab:u.Z,QSeparator:h.Z,QTabPanels:g.Z,QTabPanel:p.Z,QInput:m.Z,QCardSection:_.Z,QBtn:b.Z,QBadge:f.Z})},97623:(e,t,o)=>{"use strict";o.d(t,{Z:()=>k});var i=o(83673),n=o(62323);const r={class:"q-pa-md q-gutter-sm"},s={style:{"text-align":"center"}},l={class:"row items-center"};function a(e,t,o,a,c,d){const u=(0,i.up)("q-badge"),h=(0,i.up)("q-icon"),g=(0,i.up)("q-input"),p=(0,i.up)("q-tree"),m=(0,i.up)("q-drawer");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(m,{modelValue:d.leftDrawerSync,"onUpdate:modelValue":t[3]||(t[3]=e=>d.leftDrawerSync=e),"content-class":"bg-grey-1",elevated:"","show-if-above":""},{default:(0,i.w5)((()=>[(0,i._)("div",r,[(0,i._)("div",s,[(0,i.Wm)(u,{color:c.badge.color,"text-color":c.badge.text_color},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(d.selectNodeTitle),1)])),_:1},8,["color","text-color"])]),(0,i._)("div",null,[(0,i.Wm)(g,{ref:"filter",modelValue:c.tree.filter,"onUpdate:modelValue":t[0]||(t[0]=e=>c.tree.filter=e),label:e.$t("filter"),filled:"",onInput:d.inputListener,onFocusin:d.filterFocusIn,onFocusout:d.filterFocusOut},{append:(0,i.w5)((()=>[""!==c.tree.filter?((0,i.wg)(),(0,i.j4)(h,{key:0,class:"cursor-pointer",name:"clear",onClick:d.resetFilter},null,8,["onClick"])):(0,i.kq)("",!0)])),_:1},8,["modelValue","label","onInput","onFocusin","onFocusout"])]),(0,i._)("div",null,[(0,i.Wm)(p,{ref:"qtree","no-transition":"",expanded:c.tree.expanded,"onUpdate:expanded":t[1]||(t[1]=e=>c.tree.expanded=e),filter:c.tree.filter,nodes:c.tree.nodes,selected:c.tree.selectedNodeSync,"onUpdate:selected":[t[2]||(t[2]=e=>c.tree.selectedNodeSync=e),d.update_selected],"node-key":"nodeKey",onLazyLoad:d.onLazyLoad},{"default-header":(0,i.w5)((e=>[(0,i._)("div",l,[(0,i.Uk)((0,n.zw)(e.node.label)+" ",1),e.node.dirCount?((0,i.wg)(),(0,i.j4)(u,{key:0,color:c.badge.color,"text-color":c.badge.text_color,class:"q-ml-sm"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.node.dirCount),1)])),_:2},1032,["color","text-color"])):(0,i.kq)("",!0),e.node.hasOwnProperty("fileCount")?((0,i.wg)(),(0,i.j4)(u,{key:1,"text-color":c.badge.text_color,class:"q-ml-sm",color:"warning"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.node.fileCount),1)])),_:2},1032,["text-color"])):(0,i.kq)("",!0)])])),_:1},8,["expanded","filter","nodes","selected","onLazyLoad","onUpdate:selected"])])])])),_:1},8,["modelValue"])])}o(65663);var c=o(10741);let d=null;const u={name:"PicDrawer",props:{api_url:{type:String,required:!0},lazy_url:{type:String,required:!1},storeName:{type:String,required:!0}},data(){return{leftDrawerOpen:!0,image_shortcut:!1,tree:{filter:"",nodes:[],nodeKeyMap:new Map,expanded:[],selectedNodeSync:1},badge:{color:"primary",text_color:"white"}}},computed:{...(0,c.rn)({currentNodeKey:e=>e[d.storeName].node_key,drawer_open:e=>e[d.storeName].drawer_open}),leftDrawerSync:{get:function(){return this.$store.getters[`${this.storeName}/drawer_open`]},set:function(e){return this.$store.dispatch(`${this.storeName}/drawer_open`,e)}},selectNodeTitle:{get:function(){return this.$store.getters[`${this.storeName}/title`]},set:function(e){if(e)return this.$store.dispatch(`${this.storeName}/title`,e)}}},methods:{filterFocusIn:function(){this.$log.debug("filterFocusIn"),this.image_shortcut=this.$store.getters["common/image_shortcut"],this.$store.dispatch("common/image_shortcut",!1)},filterFocusOut:function(){this.$log.debug("filterFocusOut"),this.$store.dispatch("common/image_shortcut",this.image_shortcut)},nodesToNodeKeyMap:function(e){const t=new Map;function o(e,i=1/0,n=t){i!==1/0&&n.set(e.nodeKey,i),Array.isArray(e.children)&&e.children.length>0&&e.children.forEach((t=>o(t,e.nodeKey)))}return e.forEach((e=>o(e))),t},nodeKeyMapToExpandNodes:function(e,t=1){const o=this.tree.nodeKeyMap,i=[e];let n=e;while(n!==t)n=o.get(n),i.push(n);return i},resetFilter:function(){this.tree.filter="",this.$refs.filter.focus()},inputListener:function(e){""===e?this.tree.expanded=this.nodeKeyMapToExpandNodes(this.currentNodeKey):this.$refs.qtree.expandAll()},onLazyLoad:function({node:e,key:t,done:o,fail:i}){return this.$log.debug("lazy load:",e,t),this.$axios({method:"POST",url:this.lazy_url,params:{nodeKey:t},timeout:2e3}).then((e=>o(e))).catch((e=>{this.$log.error(e.message),i([])}))},update_selected:function(e){if(this.$log.debug(e,this.tree.selectedNodeSync),null!==e){this.$store.dispatch(`${this.storeName}/node_key`,e);const t=this.$refs.qtree.getNodeByKey(e);this.$log.debug(t),t?(this.$store.dispatch(`${this.storeName}/title`,t.label),this.tree.expanded=this.nodeKeyMapToExpandNodes(e),this.tree.selectedNodeSync=e):(this.$log.debug("??? unkown node, redirect to 1"),this.update_selected(1))}},btn_click_preNode:function(){this.update_selected(this.currentNodeKey-1)},btn_click_nextNode:function(){this.update_selected(this.currentNodeKey+1)},btn_click_leftDrawer(){this.leftDrawerSync=!this.leftDrawerSync},btn_click_setting(){}},beforeCreate(){d=this},created(){this.$bus.on("btn_click_preNode",this.btn_click_preNode),this.$bus.on("btn_click_nextNode",this.btn_click_nextNode),this.$bus.on("btn_click_leftDrawer",this.btn_click_leftDrawer),this.$bus.on("btn_click_setting",this.btn_click_setting)},unmounted(){this.$bus.off("btn_click_preNode",this.btn_click_preNode),this.$bus.off("btn_click_nextNode",this.btn_click_nextNode),this.$bus.off("btn_click_leftDrawer",this.btn_click_leftDrawer),this.$bus.off("btn_click_setting",this.btn_click_setting)},beforeMount(){},mounted(){this.$axios({method:"GET",url:this.api_url}).then((e=>(this.tree.nodes=e,e))).then((e=>(this.tree.nodeKeyMap=this.nodesToNodeKeyMap(e),this.update_selected(this.currentNodeKey),e))).then((e=>{const t=this.nodeKeyMapToExpandNodes(this.currentNodeKey);this.$log.debug(`expandedNodes: ${t}`),this.tree.expanded=t})).catch((e=>{this.$log.error("connection_fail",e),this.$q.notify({message:this.$t("connection_fail"),caption:`${e.message}`,type:"negative"})}))}};var h=o(74260),g=o(96873),p=o(69721),m=o(34842),_=o(24554),b=o(55551),f=o(7518),w=o.n(f);const y=(0,h.Z)(u,[["render",a]]),k=y;w()(u,"components",{QDrawer:g.Z,QBadge:p.Z,QInput:m.Z,QIcon:_.Z,QTree:b.Z})},46501:(e,t,o)=>{"use strict";o.d(t,{Z:()=>B});var i=o(83673),n=o(62323);const r=["onClick"],s={key:0},l={key:0,class:"waterfall-nomore"};function a(e,t,o,a,c,d){const u=(0,i.up)("lazy-img"),h=(0,i.up)("vue-waterfall"),g=(0,i.up)("tool-group"),p=(0,i.up)("pic-store-settings"),m=(0,i.up)("q-dialog"),_=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(_,{class:"full-height-width"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{ref:"waterfall",gutter:8,lazyload:!0,delay:400,list:c.water_fall.img_urls,breakpoints:c.breakpoints,crossOrigin:!1,backgroundColor:d.backgroundColor},{item:(0,i.w5)((({item:t,url:o})=>[(0,i._)("div",{class:"text-center",onClick:e=>d.card_click_event("imgBoxClickEvent",t)},[(0,i.Wm)(u,{class:"img_box",url:o},null,8,["url"]),e.show_img_title?((0,i.wg)(),(0,i.iD)("span",s,(0,n.zw)(t.info),1)):(0,i.kq)("",!0)],8,r)])),_:1},8,["list","breakpoints","backgroundColor"]),c.water_fall.no_more?((0,i.wg)(),(0,i.iD)("span",l,(0,n.zw)(e.$t("waterfallOver")),1)):(0,i.kq)("",!0),(0,i.Wm)(g,{"enable-shortcut":"image"===o.waterfall_type},null,8,["enable-shortcut"]),(0,i.Wm)(m,{ref:"dialog",onHide:d.onDialogHide},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"btn-group-setting"})])),_:1},8,["onHide"])])),_:1})}var c=o(10741),d=o(33649);const u={class:"text-h6"};function h(e,t,o,r,s,l){const a=(0,i.up)("q-card-section"),c=(0,i.up)("video-player"),d=(0,i.up)("q-card"),h=(0,i.up)("q-dialog");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(h,{ref:"player"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{style:(0,n.j5)(l.computedCardStyle),class:"player"},{default:(0,i.w5)((()=>[o.info?((0,i.wg)(),(0,i.j4)(a,{key:0,ref:"player_title",class:(0,n.C_)(l.color),style:{padding:"0.5rem"}},{default:(0,i.w5)((()=>[(0,i._)("div",u,(0,n.zw)(o.info),1)])),_:1},8,["class"])):(0,i.kq)("",!0),(0,i.Wm)(a,{class:"player-padding"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{ref:"videoPlayer","playback-rate":s.playbackRate,options:l.playerOpts,customEventName:"changed",onChanged:t[0]||(t[0]=e=>l.playerStateChanged(e)),onReady:l.playerIsReady},null,8,["playback-rate","options","onReady"])])),_:1})])),_:1},8,["style"])])),_:1},512)])}o(65663),o(43709);var g=o(61959),p=o(23510);const m={name:"PicVPlayer",components:{VideoPlayer:p.Y7},props:{info:{type:String,required:!1,default:""},video:{type:String,required:!0},src:{type:String,required:!1,default:""},height:{type:Number,required:!1,default:300},width:{type:Number,required:!1,default:600}},computed:{...(0,c.rn)({user_type:e=>e.user.user_type}),color(){const e=[0,1];return e.indexOf(this.user_type)>=0?"bg-pink-4 text-white text-center":"bg-primary text-white text-center"},player(){return this.$refs.videoPlayer.player},computedSize(){const e=this.height/this.width,t=.8*(0,d.hA)(),o=.8*(0,d.Ti)(),i=this.width>t?t:this.width,n=this.height>o?o:this.height,r=Math.floor(i*e),s=Math.floor(n/e),l={height:0,width:0};return r>n?(l.height=n,l.width=s):s>i?(l.height=r,l.width=i):(l.height=r,l.width=s),l},computedCardStyle(){const e=[],t=this.computedSize;for(const o in t)e.push(`${o}: ${"height"===o?t[o]+48:t[o]}px`);return e.join(";")},playerOpts(){return{autoplay:!1,language:"zh",languages:["zh","en"],liveui:!0,controls:!0,html5:{nativeControlsForTouch:!0},playbackRates:[.7,1,1.1,1.2,1.5,2],...this.computedSize,sources:[{src:this.video}],poster:this.src,plugins:{hotkeys:{volumeStep:.1,seekStep:5,enableModifiersForNumbers:!1,fullscreenKey:function(e,t){return 70===e.which||e.ctrlKey&&13===e.which||13===e.which}}}}}},data(){return{playbackRate:1.1}},methods:{playerStateChanged(e){},playerIsReady(e){this.$log.debug("player ready!",e,(0,g.IU)(e),e.target.player)},show(){this.$log.debug("show"),this.$refs.player.show()},hide(){this.$log.debug("hide"),this.$refs.player.hide()},onDialogHide(){this.$log.debug("hide"),this.$emit("hide")},onOKClick(){this.$log.debug("onClick"),this.$emit("ok"),this.hide()},onCancelClick(){this.$log.debug("onCancelClick"),this.hide()}},mounted(){this.$log.debug("mounted",this.$refs.player.$el),this.$refs.player.$el.onkeydown=e=>{switch(this.$log.debug("keydown",e),e.key){case"c":this.playbackRate+=.1;break;case"x":this.playbackRate-=.05;break;case"z":this.playbackRate=1;break}this.playbackRate=+this.playbackRate.toFixed(2)}},unmounted(){this.$log.debug("unmounted")}};var _=o(74260),b=o(46778),f=o(10151),w=o(25589),y=o(7518),k=o.n(y);const $=(0,_.Z)(m,[["render",h],["__scopeId","data-v-2bc79623"]]),v=$;k()(m,"components",{QDialog:b.Z,QCard:f.Z,QCardSection:w.Z});const x={key:0,class:"tool-group",ref:"tools"};function q(e,t,o,n,r,s){const l=(0,i.up)("tool-button");return r.show?((0,i.wg)(),(0,i.iD)("div",x,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.toolButtonGroup,(e=>((0,i.wg)(),(0,i.j4)(l,(0,i.dG)({key:e.btnColor},e),null,16)))),128))],512)):(0,i.kq)("",!0)}function N(e,t,o,r,s,l){const a=(0,i.up)("q-tooltip"),c=(0,i.up)("q-btn");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(c,{color:o.btnColor,icon:o.btnIcon,round:o.btnRound,onClick:o.btnOnClick},{default:(0,i.w5)((()=>[0!==o.tooltipMessage.length?((0,i.wg)(),(0,i.j4)(a,{key:0,anchor:o.tooltipAnchor,self:o.tooltipSelf},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.tooltipMessage),1)])),_:1},8,["anchor","self"])):(0,i.kq)("",!0)])),_:1},8,["color","icon","round","onClick"])])}const C={name:"ToolButton",props:{btnOnClick:{type:Function,required:!0},btnIcon:{type:String,required:!0},btnColor:{type:String,required:!0,default:"primary"},btnRound:{type:Boolean,required:!1,default:!0},tooltipMessage:{type:String,required:!0,default:""},tooltipAnchor:{type:String,required:!1,default:"center left"},tooltipSelf:{type:String,required:!1,default:"center right"}}};var S=o(48240),I=o(5363);const Z=(0,_.Z)(C,[["render",N]]),M=Z;k()(C,"components",{QBtn:S.Z,QTooltip:I.Z});const D=window.innerHeight,W={scrollUp:["w","ArrowUp"],scrollDown:["s","ArrowDown"],btn_click_preNode:["a","ArrowLeft"],loadMore:["d","ArrowRight"],top:["q"],nextNode:["e"],reloadPage:["r"]},T={name:"ToolGroup",components:{ToolButton:M},props:{enableShortcut:{type:Boolean,required:!1,default:!1},shortcutElement:{type:Object,required:!1}},data(){return{show:!0}},computed:{...(0,c.rn)({tool_group_force_right:e=>e.common.tool_group_force_right,image_shortcut:e=>e.common.image_shortcut}),shortcutEle(){return this.shortcutElement||document},toolButtonGroup(){return[{btnOnClick:this.top,btnIcon:"navigation",btnColor:"primary",tooltipMessage:this.$t("top")},{btnOnClick:this.nextNode,btnIcon:"redo",btnColor:"cyan-5",tooltipMessage:this.$t("next_one")},{btnOnClick:this.loadMore,btnIcon:"replay_10",btnColor:"warning",tooltipMessage:this.$t("loadManual")},{btnOnClick:this.leftDrawer,btnIcon:"open_in_new",btnColor:"pink-3",tooltipMessage:this.$t("open_drawer")},{btnOnClick:this.setting,btnIcon:"settings",btnColor:"secondary",tooltipMessage:this.$t("setting")}]}},methods:{top:function(){this.$log.debug("go top"),this.$bus.emit("btn_click_goto_top")},nextNode:function(){this.$log.debug("nextNode"),this.$bus.emit("btn_click_nextNode")},reloadPage:function(){this.$log.debug("reloadPage"),location.reload()},btn_click_preNode(){this.$log.debug("preNode"),this.$bus.emit("btn_click_preNode")},loadMore:function(){this.$log.debug("loadMore"),this.$bus.emit("btn_click_loadMore")},leftDrawer:function(){this.$log.debug("leftDrawer"),this.$bus.emit("btn_click_leftDrawer")},setting:function(){this.$log.debug("setting"),this.$bus.emit("btn_click_setting")},scrollUp(e){e.preventDefault(),window.scrollBy({top:-D,behavior:"smooth"})},scrollDown(e){e.preventDefault(),window.scrollBy({top:D,behavior:"smooth"})},shortcut:function(e){if(!this.image_shortcut)return;const t=e.key;this.$log.debug(`keyName: ${t}`);const o=document.getElementsByClassName("viewer-open");if(o.length>0)this.$log.debug("viewer-open, ignore shortcut");else for(const i in W)if(W[i].indexOf(t)>=0){this.$log.debug(`find ${t} in keymap[${i}] -> ${W[i]}, call...`),this[i](e);break}}},mounted(){const e={web:{right:"1.5rem",bottom:"20px"},mobile:{left:"1.5rem",bottom:"60px"}},t=this.$q.platform.is.mobile&&!this.tool_group_force_right?"mobile":"web";for(const o in e[t])this.$refs.tools.style[o]=e[t][o];this.enableShortcut&&this.shortcutEle.addEventListener("keyup",this.shortcut)},unmounted(){this.enableShortcut&&this.shortcutEle.removeEventListener("keyup",this.shortcut)}},z=(0,_.Z)(T,[["render",q],["__scopeId","data-v-954d4de6"]]),V=z;var O=o(57006);var Q=o(88639);Q.wU,Boolean,(0,c.rn)({viewerPlayInterval:e=>e.image.viewer_play_interval});var K=o(70568);let P=null,U=null;const j={name:"PicWaterfall",components:{ToolGroup:V,PicStoreSettings:O.Z,VueWaterfall:K.p,LazyImg:K.j},props:{api_url:{type:String,required:!0},storeName:{type:String,required:!0},waterfall_type:{type:String,required:!1,default:"image",validate:e=>"video,image".split(",").indexOf(e)>=0}},data(){return{water_fall:{show:!0,no_more:!1,page:0,img_urls:[]},breakpoints:{1500:{rowPerView:6},1250:{rowPerView:5},1e3:{rowPerView:4},750:{rowPerView:3},500:{rowPerView:2},300:{rowPerView:1}}}},computed:{...(0,c.rn)({node_key:e=>e[P.storeName].node_key,waterfall_col:e=>e[P.storeName].waterfall_col,show_img_title:e=>e[P.storeName].show_img_title,skip_empty_dir:e=>e[P.storeName].skip_empty_dir,waterfall_stride:e=>e[P.storeName].waterfall_stride,title_max_length:e=>e[P.storeName].title_max_length,auto_next:e=>e[P.storeName].auto_next}),reach_bottom_distance(){const e=(0,d.Ti)();return Math.floor(.2*e)},backgroundColor(){return this.$log.debug("dark mode: ",this.$q.dark.isActive),this.$q.dark.isActive?"#121212":"#ffffff"}},watch:{node_key(e){this.$log.debug(`nodeKey updated: ${e}`),this.resetConfig(),this.loadMore(),this.btn_click_goto_top()}},methods:{footerHeight(){return this.show_img_title?18:0},show(){this.$log.debug("show"),this.$log.debug(this.$refs),this.$refs.dialog.show()},hide(){this.$log.debug("hide"),this.$refs.dialog.hide()},onDialogHide(){this.$log.debug("hide"),this.$emit("hide")},imgErrorEvent:function(e){return this.$q.notify({type:"warning",message:this.$t("img_load_error")+"",caption:`${e.src}`})},card_click_event(e,t){switch(this.$log.debug("card_click_event",e,t),this.waterfall_type){case"video":return this.showVideoDialog(t);case"image":default:return this.showImageViewer(t)}},showImageViewer(e){let t=parseInt(e.index)||Math.max(0,this.water_fall.img_urls.indexOf(e));this.$log.debug("showImageViewer",t),this.$viewerApi(this.viewerOpts(t))},showVideoDialog(e){return this.$log.debug("showVideoDialog",e),this.$q.dialog({component:v,parent:this,componentProps:{...e}})},resetConfig(){for(const e in U)this.water_fall[e]=U[e];this.water_fall.no_more=!1},loadMore(){if(this.water_fall.no_more)return this.$q.notify({type:"warn",message:this.$t("no_more_pic")+""}),void(this.auto_next&&(this.$q.notify({type:"positive",message:"auto_next success!!!"}),this.$bus.emit("btn_click_nextNode")));const e={nodeKey:this.node_key,page:this.water_fall.page,page_size:this.waterfall_stride};return this.$axios.post(this.api_url,e).then((t=>(this.$log.debug("req res:",t),t.length<e.page_size&&(this.water_fall.no_more=!0),t))).then((e=>e.map((e=>{let t=e.video?e.video:e.src;t=t.includes("%")?decodeURI(t):t;let o=t.split("/").pop().split(".");return o.pop(),o=o.join(".").slice(0,this.title_max_length),e["info"]=o,e})))).then((e=>e.map((e=>({...e,imgSrc:e.src}))))).then((e=>{this.$log.debug("set waterfall urls",e),this.water_fall.img_urls=this.water_fall.img_urls.concat(e)})).then((()=>this.water_fall.page++)).catch((e=>{this.$q.notify({type:"warn",message:e.message})}))},btn_click_goto_top(){this.$log.debug("waterfall",this.$refs.waterfall.$el),document.querySelector("html").scrollTop=0},btn_click_loadMore(){return this.loadMore()},viewerOpts(e=0){let t={toolbar:!0,keyboard:!0,focus:!0,interval:2e3,url:"src",loop:!1},o={images:this.water_fall.img_urls,options:{...t,initialViewIndex:e}};return o}},beforeCreate(){P=this,this.$log.debug(this.$store.getters)},created(){U=JSON.parse(JSON.stringify(this.water_fall)),this.$bus.on("btn_click_goto_top",this.btn_click_goto_top),this.$bus.on("btn_click_loadMore",this.btn_click_loadMore),this.$bus.on("btn_click_setting",this.show)},mounted(){"video"===this.storeName&&this.$store.dispatch(`${this.storeName}/show_img_title`,!0),this.loadMore()},unmounted(){this.$log.debug("waterfall destroy"),this.$bus.off("btn_click_goto_top",this.btn_click_goto_top),this.$bus.off("btn_click_loadMore",this.btn_click_loadMore),this.$bus.off("btn_click_setting",this.show)}};var E=o(24379);const L=(0,_.Z)(j,[["render",a]]),B=L;k()(j,"components",{QPage:E.Z,QDialog:b.Z})},25893:()=>{}}]);